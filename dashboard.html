<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>حساب العميل</title>
  <style>
    body {
      margin: 0;
      font-family: 'Tahoma', sans-serif;
      background: linear-gradient(135deg, rgba(0,0,0,0.85), rgba(0,60,120,0.9)),
                  url('https://source.unsplash.com/1600x900/?business,finance');
      background-size: cover;
      background-attachment: fixed;
      color: #fff;
    }

    header {
      background: rgba(0,0,0,0.7);
      padding: 15px 30px;
      text-align: center;
      font-size: 22px;
      font-weight: bold;
      letter-spacing: 1px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.6);
    }

    main {
      max-width: 800px;
      margin: 30px auto;
      padding: 20px;
      border-radius: 15px;
      background: rgba(255,255,255,0.08);
      backdrop-filter: blur(12px);
      box-shadow: 0 0 25px rgba(0,0,0,0.6);
    }

    .info-box {
      background: rgba(255,255,255,0.1);
      padding: 15px;
      border-radius: 12px;
      margin-bottom: 15px;
    }

    .info-box h3 { margin: 0 0 10px; }

    .balance {
      font-size: 24px;
      font-weight: bold;
      color: #00ffcc;
    }

    button {
      margin: 8px 5px;
      padding: 12px 20px;
      border: none;
      border-radius: 10px;
      background: #00c3ff;
      color: #fff;
      font-size: 15px;
      font-weight: bold;
      cursor: pointer;
      transition: 0.3s;
    }
    button:hover { background: #008bbf; }

    table {
      width: 100%;
      margin-top: 20px;
      border-collapse: collapse;
      border-radius: 10px;
      overflow: hidden;
      background: rgba(255,255,255,0.1);
    }

    th, td {
      padding: 12px;
      text-align: center;
      border-bottom: 1px solid rgba(255,255,255,0.2);
    }

    th {
      background: rgba(0,0,0,0.6);
      font-weight: bold;
    }
  </style>
</head>
<body>
  <header>لوحة تحكم العميل</header>
  <main>
    <div class="info-box">
      <h3>👤 الاسم:</h3>
      <p id="clientName">--</p>
    </div>

    <div class="info-box">
      <h3>📧 البريد الإلكتروني:</h3>
      <p id="clientEmail">--</p>
    </div>

    <div class="info-box">
      <h3>📱 رقم الهاتف:</h3>
      <p id="clientPhone">--</p>
    </div>

    <div class="info-box">
      <h3>💰 الرصيد الحالي:</h3>
      <p class="balance" id="clientBalance">0 $</p>
    </div>

    <button onclick="deposit()">💳 إيداع</button>
    <button onclick="withdraw()">💵 سحب</button>

    <h3 style="margin-top:30px;">📜 العمليات</h3>
    <table>
      <thead>
        <tr>
          <th>النوع</th>
          <th>المبلغ</th>
          <th>التاريخ</th>
        </tr>
      </thead>
      <tbody id="transactions">
        <tr><td colspan="3">لا يوجد عمليات بعد</td></tr>
      </tbody>
    </table>
  </main>

  <script type="module">
    import { getAuth, onAuthStateChanged, signOut }
      from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import { getFirestore, doc, getDoc, updateDoc, arrayUnion }
      from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
    import { app } from "./firebase.js";

    const auth = getAuth(app);
    const db = getFirestore(app);

    const nameEl = document.getElementById("clientName");
    const emailEl = document.getElementById("clientEmail");
    const phoneEl = document.getElementById("clientPhone");
    const balanceEl = document.getElementById("clientBalance");
    const txEl = document.getElementById("transactions");

    onAuthStateChanged(auth, async (user) => {
      if (user) {
        const ref = doc(db, "users", user.uid);
        const snap = await getDoc(ref);
        if (snap.exists()) {
          const data = snap.data();
          nameEl.textContent = data.name;
          emailEl.textContent = data.email;
          phoneEl.textContent = data.phone;
          balanceEl.textContent = data.balance + " $";

          if (data.transactions.length > 0) {
            txEl.innerHTML = "";
            data.transactions.forEach(tx => {
              const row = document.createElement("tr");
              row.innerHTML = `<td>${tx.type}</td><td>${tx.amount} $</td><td>${tx.date}</td>`;
              txEl.appendChild(row);
            });
          }
        }
      } else {
        window.location.href = "login.html";
      }
    });

    window.deposit = () => {
      alert("💳 يرجى تحويل الأموال إلى محفظة USDT:\n0x7F8125C197B845E1F0682A9846B94A11cA9d9743");
    };

    window.withdraw = async () => {
      const addr = prompt("أدخل عنوان محفظة USDT لسحب الأموال:");
      if (!addr) return;

      const amount = prompt("أدخل المبلغ المطلوب سحبه:");
      if (!amount || isNaN(amount)) return alert("❌ المبلغ غير صالح");

      const user = auth.currentUser;
      const ref = doc(db, "users", user.uid);
      const snap = await getDoc(ref);
      const data = snap.data();

      if (parseFloat(amount) > data.balance) {
        return alert("❌ الرصيد غير كافي");
      }

      await updateDoc(ref, {
        balance: data.balance - parseFloat(amount),
        transactions: arrayUnion({
          type: "سحب",
          amount,
          date: new Date().toLocaleString()
        })
      });

      alert("✅ تم تسجيل طلب السحب، سيتم تحويل الأموال قريباً");
      location.reload();
    };
  </script>
</body>
</html>
